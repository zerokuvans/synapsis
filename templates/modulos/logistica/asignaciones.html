{% extends "base.html" %}

{% block title %}Asignaciones{% endblock %}

{% block extra_css %}
<!-- DataTables CSS -->
<link href="https://cdn.datatables.net/1.11.5/css/dataTables.bootstrap5.min.css" rel="stylesheet">
<!-- SweetAlert2 CSS -->
<link href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css" rel="stylesheet">
<!-- Font Awesome -->
<link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
<style>
    .card {
        box-shadow: 0 0.125rem 0.25rem rgba(0, 0, 0, 0.075);
        margin-bottom: 1.5rem;
    }
    .card-header {
        background-color: #f8f9fa;
        border-bottom: 1px solid rgba(0,0,0,.125);
    }
    .form-check {
        padding: 0.5rem;
        border-radius: 0.25rem;
        transition: background-color 0.2s;
    }
    .form-check:hover {
        background-color: #f8f9fa;
    }
    .form-check-input:checked {
        background-color: #0d6efd;
        border-color: #0d6efd;
    }
    .modal-lg {
        max-width: 900px;
    }
    .tool-category {
        background-color: #f8f9fa;
        padding: 1rem;
        border-radius: 0.5rem;
        margin-bottom: 1rem;
    }
    .tool-category h6 {
        color: #0d6efd;
        margin-bottom: 1rem;
        font-weight: 600;
    }
</style>
{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <div class="d-flex justify-content-between align-items-center mb-4">
        <h1 class="h3 mb-0">
            <i class="fas fa-tools me-2"></i>Gestión de Asignaciones
        </h1>
        <div>
            <button type="button" class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#modalAsignacion">
                <i class="fas fa-plus me-2"></i>Nueva Asignación
            </button>
            <a href="{{ url_for('exportar_asignaciones_csv') }}" class="btn btn-success ms-2">
                <i class="fas fa-file-csv me-2"></i>Exportar a CSV
            </a>
        </div>
    </div>

    <!-- Tabla de Asignaciones -->
    <div class="card">
        <div class="card-header bg-white">
            <div class="d-flex justify-content-between align-items-center">
                <h5 class="mb-0">
                    <i class="fas fa-list me-2"></i>Asignaciones Registradas
                </h5>
            </div>
        </div>
        <div class="card-body">
            <div class="table-responsive">
                <table class="table table-bordered table-striped table-hover" id="tablaAsignaciones">
                    <thead class="table-light">
                        <tr>
                            <th>ID</th>
                            <th>Fecha</th>
                            <th>Técnico</th>
                            <th>Cédula</th>
                            <th>Cargo</th>
                            <th>Estado</th>
                            <th>Acciones</th>
                        </tr>
                    </thead>
                    <tbody>
                        {% for asignacion in asignaciones %}
                        <tr>
                            <td>{{ asignacion.id_asignacion }}</td>
                            <td>{{ asignacion.asignacion_fecha.strftime('%Y-%m-%d %H:%M:%S') }}</td>
                            <td>{{ asignacion.nombre }}</td>
                            <td>{{ asignacion.recurso_operativo_cedula }}</td>
                            <td>{{ asignacion.asignacion_cargo }}</td>
                            <td>
                                <span class="badge {% if asignacion.asignacion_estado == '1' %}bg-success{% else %}bg-danger{% endif %}">
                                    {{ 'Activo' if asignacion.asignacion_estado == '1' else 'Inactivo' }}
                                </span>
                            </td>
                            <td>
                                <button type="button" class="btn btn-sm btn-info" onclick="verDetalle({{ asignacion.id_asignacion }})">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </td>
                        </tr>
                        {% endfor %}
                    </tbody>
                </table>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Asignación -->
<div class="modal fade" id="modalAsignacion" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="fas fa-plus-circle me-2"></i>Nueva Asignación
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="formAsignacion">
                    <!-- Información Básica -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-user me-2"></i>Información Básica
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row mb-3">
                                <div class="col-md-6">
                                    <label for="id_codigo_consumidor" class="form-label">
                                        <i class="fas fa-user-tie me-1"></i>Técnico *
                                    </label>
                                    <select class="form-select" id="id_codigo_consumidor" name="id_codigo_consumidor" required>
                                        <option value="">Seleccione...</option>
                                        {% for tecnico in tecnicos %}
                                        <option value="{{ tecnico.id_codigo_consumidor }}">{{ tecnico.nombre }} - {{ tecnico.recurso_operativo_cedula }}</option>
                                        {% endfor %}
                                    </select>
                                </div>
                                <div class="col-md-6">
                                    <label for="fecha" class="form-label">
                                        <i class="fas fa-calendar me-1"></i>Fecha *
                                    </label>
                                    <input type="datetime-local" class="form-control" id="fecha" name="fecha" required>
                                </div>
                            </div>
                            <div class="row">
                                <div class="col-md-6">
                                    <label for="cargo" class="form-label">
                                        <i class="fas fa-briefcase me-1"></i>Cargo *
                                    </label>
                                    <input type="text" class="form-control" id="cargo" name="cargo" required>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Herramientas Básicas -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-wrench me-2"></i>Herramientas Básicas
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="adaptador_mandril" name="adaptador_mandril" value="1">
                                        <label class="form-check-label" for="adaptador_mandril">
                                            <i class="fas fa-cog me-1"></i>Adaptador Mandril
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="alicate" name="alicate" value="1">
                                        <label class="form-check-label" for="alicate">
                                            <i class="fas fa-tools me-1"></i>Alicate
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="barra_45cm" name="barra_45cm" value="1">
                                        <label class="form-check-label" for="barra_45cm">
                                            <i class="fas fa-ruler me-1"></i>Barra 45cm
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="bisturi_metalico" name="bisturi_metalico" value="1">
                                        <label class="form-check-label" for="bisturi_metalico">
                                            <i class="fas fa-cut me-1"></i>Bisturí Metálico
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="caja_de_herramientas" name="caja_de_herramientas" value="1">
                                        <label class="form-check-label" for="caja_de_herramientas">
                                            <i class="fas fa-toolbox me-1"></i>Caja de Herramientas
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="cortafrio" name="cortafrio" value="1">
                                        <label class="form-check-label" for="cortafrio">
                                            <i class="fas fa-hammer me-1"></i>Cortafrío
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="destor_de_estrella" name="destor_de_estrella" value="1">
                                        <label class="form-check-label" for="destor_de_estrella">
                                            <i class="fas fa-screwdriver me-1"></i>Destornillador Estrella
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="destor_de_pala" name="destor_de_pala" value="1">
                                        <label class="form-check-label" for="destor_de_pala">
                                            <i class="fas fa-screwdriver me-1"></i>Destornillador Pala
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="destor_tester" name="destor_tester" value="1">
                                        <label class="form-check-label" for="destor_tester">
                                            <i class="fas fa-screwdriver me-1"></i>Destornillador Tester
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="espatula" name="espatula" value="1">
                                        <label class="form-check-label" for="espatula">
                                            <i class="fas fa-paint-brush me-1"></i>Espátula
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="martillo_de_una" name="martillo_de_una" value="1">
                                        <label class="form-check-label" for="martillo_de_una">
                                            <i class="fas fa-hammer me-1"></i>Martillo de Uña
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pinza_de_punta" name="pinza_de_punta" value="1">
                                        <label class="form-check-label" for="pinza_de_punta">
                                            <i class="fas fa-tools me-1"></i>Pinza de Punta
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Brocas -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-drill me-2"></i>Brocas
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="broca_3/8" name="broca_3/8" value="1">
                                        <label class="form-check-label" for="broca_3/8">
                                            <i class="fas fa-circle me-1"></i>Broca 3/8
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="broca_3/8/6_ran" name="broca_3/8/6_ran" value="1">
                                        <label class="form-check-label" for="broca_3/8/6_ran">
                                            <i class="fas fa-circle me-1"></i>Broca 3/8 6 Ran
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="broca_1/2/6_ran" name="broca_1/2/6_ran" value="1">
                                        <label class="form-check-label" for="broca_1/2/6_ran">
                                            <i class="fas fa-circle me-1"></i>Broca 1/2 6 Ran
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="broca_metal/madera_1/4" name="broca_metal/madera_1/4" value="1">
                                        <label class="form-check-label" for="broca_metal/madera_1/4">
                                            <i class="fas fa-circle me-1"></i>Broca Metal/Madera 1/4
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="broca_metal/madera_3/8" name="broca_metal/madera_3/8" value="1">
                                        <label class="form-check-label" for="broca_metal/madera_3/8">
                                            <i class="fas fa-circle me-1"></i>Broca Metal/Madera 3/8
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="broca_metal/madera_5/16" name="broca_metal/madera_5/16" value="1">
                                        <label class="form-check-label" for="broca_metal/madera_5/16">
                                            <i class="fas fa-circle me-1"></i>Broca Metal/Madera 5/16
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Herramientas de Red -->
                    <div class="card mb-4">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-network-wired me-2"></i>Herramientas de Red
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="cajon_rojo" name="cajon_rojo" value="1">
                                        <label class="form-check-label" for="cajon_rojo">
                                            <i class="fas fa-box me-1"></i>Cajón Rojo
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="cinta_de_senal" name="cinta_de_senal" value="1">
                                        <label class="form-check-label" for="cinta_de_senal">
                                            <i class="fas fa-tape me-1"></i>Cinta de Señal
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="cono_retractil" name="cono_retractil" value="1">
                                        <label class="form-check-label" for="cono_retractil">
                                            <i class="fas fa-triangle-exclamation me-1"></i>Cono Retráctil
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="exten_de_corr_10_mts" name="exten_de_corr_10_mts" value="1">
                                        <label class="form-check-label" for="exten_de_corr_10_mts">
                                            <i class="fas fa-plug me-1"></i>Extensión de Corriente 10mts
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="llave_locking_male" name="llave_locking_male" value="1">
                                        <label class="form-check-label" for="llave_locking_male">
                                            <i class="fas fa-key me-1"></i>Llave Locking Male
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="llave_reliance" name="llave_reliance" value="1">
                                        <label class="form-check-label" for="llave_reliance">
                                            <i class="fas fa-key me-1"></i>Llave Reliance
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="llave_torque_rg_11" name="llave_torque_rg_11" value="1">
                                        <label class="form-check-label" for="llave_torque_rg_11">
                                            <i class="fas fa-key me-1"></i>Llave Torque RG11
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="llave_torque_rg_6" name="llave_torque_rg_6" value="1">
                                        <label class="form-check-label" for="llave_torque_rg_6">
                                            <i class="fas fa-key me-1"></i>Llave Torque RG6
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="llaves_mandril" name="llaves_mandril" value="1">
                                        <label class="form-check-label" for="llaves_mandril">
                                            <i class="fas fa-key me-1"></i>Llaves Mandril
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="mandril_para_taladro" name="mandril_para_taladro" value="1">
                                        <label class="form-check-label" for="mandril_para_taladro">
                                            <i class="fas fa-cog me-1"></i>Mandril para Taladro
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pelacable_rg_6y_rg_11" name="pelacable_rg_6y_rg_11" value="1">
                                        <label class="form-check-label" for="pelacable_rg_6y_rg_11">
                                            <i class="fas fa-cut me-1"></i>Pelacable RG6/RG11
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pistola_de_silicona" name="pistola_de_silicona" value="1">
                                        <label class="form-check-label" for="pistola_de_silicona">
                                            <i class="fas fa-gun me-1"></i>Pistola de Silicona
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="planillero" name="planillero" value="1">
                                        <label class="form-check-label" for="planillero">
                                            <i class="fas fa-clipboard me-1"></i>Planillero
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="ponchadora_rg_6_y_rg_11" name="ponchadora_rg_6_y_rg_11" value="1">
                                        <label class="form-check-label" for="ponchadora_rg_6_y_rg_11">
                                            <i class="fas fa-network-wired me-1"></i>Ponchadora RG6/RG11
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="ponchadora_rj_45_y_rj11" name="ponchadora_rj_45_y_rj11" value="1">
                                        <label class="form-check-label" for="ponchadora_rj_45_y_rj11">
                                            <i class="fas fa-network-wired me-1"></i>Ponchadora RJ45/RJ11
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="probador_de_tonos" name="probador_de_tonos" value="1">
                                        <label class="form-check-label" for="probador_de_tonos">
                                            <i class="fas fa-wave-square me-1"></i>Probador de Tonos
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="probador_de_tonos_utp" name="probador_de_tonos_utp" value="1">
                                        <label class="form-check-label" for="probador_de_tonos_utp">
                                            <i class="fas fa-wave-square me-1"></i>Probador de Tonos UTP
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="puntas_para_multimetro" name="puntas_para_multimetro" value="1">
                                        <label class="form-check-label" for="puntas_para_multimetro">
                                            <i class="fas fa-bolt me-1"></i>Puntas para Multímetro
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="sonda_metalica" name="sonda_metalica" value="1">
                                        <label class="form-check-label" for="sonda_metalica">
                                            <i class="fas fa-probe me-1"></i>Sonda Metálica
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="tacos_de_madera" name="tacos_de_madera" value="1">
                                        <label class="form-check-label" for="tacos_de_madera">
                                            <i class="fas fa-cube me-1"></i>Tacos de Madera
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="telefono_de_pruebas" name="telefono_de_pruebas" value="1">
                                        <label class="form-check-label" for="telefono_de_pruebas">
                                            <i class="fas fa-phone me-1"></i>Teléfono de Pruebas
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="power_miter" name="power_miter" value="1">
                                        <label class="form-check-label" for="power_miter">
                                            <i class="fas fa-bolt me-1"></i>Power Meter
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="bfl_laser" name="bfl_laser" value="1">
                                        <label class="form-check-label" for="bfl_laser">
                                            <i class="fas fa-laser me-1"></i>BFL Laser
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="cortadora" name="cortadora" value="1">
                                        <label class="form-check-label" for="cortadora">
                                            <i class="fas fa-cut me-1"></i>Cortadora
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="stripper_fibra" name="stripper_fibra" value="1">
                                        <label class="form-check-label" for="stripper_fibra">
                                            <i class="fas fa-cut me-1"></i>Stripper Fibra
                                        </label>
                                    </div>
                                </div>
                                <div class="col-md-4">
                                    <div class="form-check">
                                        <input class="form-check-input" type="checkbox" id="pelachaqueta" name="pelachaqueta" value="1">
                                        <label class="form-check-label" for="pelachaqueta">
                                            <i class="fas fa-cut me-1"></i>Pelachaqueta
                                        </label>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cancelar
                </button>
                <button type="button" class="btn btn-primary" onclick="guardarAsignacion()">
                    <i class="fas fa-save me-2"></i>Guardar
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Modal de Detalle -->
<div class="modal fade" id="modalDetalle" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-info text-white">
                <h5 class="modal-title">
                    <i class="fas fa-eye me-2"></i>Detalle de Asignación
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div id="detalleContenido"></div>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
                    <i class="fas fa-times me-2"></i>Cerrar
                </button>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<!-- DataTables JS -->
<script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.min.js"></script>
<script src="https://cdn.datatables.net/1.11.5/js/dataTables.bootstrap5.min.js"></script>
<!-- SweetAlert2 JS -->
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

<script>
$(document).ready(function() {
    $('#tablaAsignaciones').DataTable({
        language: {
            "sProcessing":     "Procesando...",
            "sLengthMenu":     "Mostrar _MENU_ registros",
            "sZeroRecords":    "No se encontraron resultados",
            "sEmptyTable":     "Ningún dato disponible en esta tabla",
            "sInfo":           "Mostrando registros del _START_ al _END_ de un total de _TOTAL_ registros",
            "sInfoEmpty":      "Mostrando registros del 0 al 0 de un total de 0 registros",
            "sInfoFiltered":   "(filtrado de un total de _MAX_ registros)",
            "sInfoPostFix":    "",
            "sSearch":         "Buscar:",
            "sUrl":            "",
            "sInfoThousands":  ",",
            "sLoadingRecords": "Cargando...",
            "oPaginate": {
                "sFirst":    "Primero",
                "sLast":     "Último",
                "sNext":     "Siguiente",
                "sPrevious": "Anterior"
            },
            "oAria": {
                "sSortAscending":  ": Activar para ordenar la columna de manera ascendente",
                "sSortDescending": ": Activar para ordenar la columna de manera descendente"
            }
        },
        order: [[1, 'desc']], // Ordenar por fecha descendente
        pageLength: 10
    });

    // Establecer fecha y hora actual por defecto
    const now = new Date();
    now.setMinutes(now.getMinutes() - now.getTimezoneOffset());
    document.getElementById('fecha').value = now.toISOString().slice(0,16);
});

function guardarAsignacion() {
    const formData = new FormData(document.getElementById('formAsignacion'));
    
    fetch('/logistica/registrar_asignacion', {
        method: 'POST',
        body: formData
    })
    .then(response => response.json())
    .then(data => {
        if (data.status === 'success') {
            Swal.fire({
                icon: 'success',
                title: 'Éxito',
                text: data.message,
                showConfirmButton: false,
                timer: 1500
            }).then(() => {
                window.location.reload();
            });
        } else {
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: data.message
            });
        }
    })
    .catch(error => {
        console.error('Error:', error);
        Swal.fire({
            icon: 'error',
            title: 'Error',
            text: 'Ha ocurrido un error al procesar la solicitud'
        });
    });
}

function verDetalle(id) {
    fetch(`/logistica/asignacion/${id}`)
        .then(response => response.json())
        .then(data => {
            if (data.status === 'success') {
                const detalles = data.data;
                console.log('Detalles recibidos:', detalles); // Debug log
                
                let html = `
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-user me-2"></i>Información del Técnico
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                                <div class="col-md-6">
                                    <p><strong><i class="fas fa-user-tie me-2"></i>Técnico:</strong> ${detalles.info_basica.tecnico}</p>
                                    <p><strong><i class="fas fa-id-card me-2"></i>Cédula:</strong> ${detalles.info_basica.cedula}</p>
                                    <p><strong><i class="fas fa-briefcase me-2"></i>Cargo:</strong> ${detalles.info_basica.cargo}</p>
                                </div>
                                <div class="col-md-6">
                                    <p><strong><i class="fas fa-calendar me-2"></i>Fecha:</strong> ${detalles.info_basica.fecha}</p>
                                    <p><strong><i class="fas fa-circle-check me-2"></i>Estado:</strong> ${detalles.info_basica.estado}</p>
                                </div>
                            </div>
                        </div>
                    </div>
                `;

                // Herramientas Básicas
                html += `
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-wrench me-2"></i>Herramientas Básicas
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                `;
                for (const [herramienta, valor] of Object.entries(detalles.herramientas_basicas)) {
                    if (valor === '1') {
                        html += `
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" disabled checked>
                                    <label class="form-check-label">
                                        <i class="fas fa-tools me-1"></i>${herramienta.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                    </label>
                                </div>
                            </div>
                        `;
                    }
                }
                html += `
                            </div>
                        </div>
                    </div>
                `;

                // Brocas
                html += `
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-drill me-2"></i>Brocas
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                `;
                for (const [broca, valor] of Object.entries(detalles.brocas)) {
                    if (valor === '1') {
                        html += `
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" disabled checked>
                                    <label class="form-check-label">
                                        <i class="fas fa-circle me-1"></i>${broca.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                    </label>
                                </div>
                            </div>
                        `;
                    }
                }
                html += `
                            </div>
                        </div>
                    </div>
                `;

                // Herramientas de Red
                html += `
                    <div class="card mb-3">
                        <div class="card-header bg-light">
                            <h6 class="mb-0">
                                <i class="fas fa-network-wired me-2"></i>Herramientas de Red
                            </h6>
                        </div>
                        <div class="card-body">
                            <div class="row">
                `;
                for (const [herramienta, valor] of Object.entries(detalles.herramientas_red)) {
                    if (valor === '1') {
                        html += `
                            <div class="col-md-4">
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" disabled checked>
                                    <label class="form-check-label">
                                        <i class="fas fa-network-wired me-1"></i>${herramienta.replace(/_/g, ' ').replace(/\b\w/g, l => l.toUpperCase())}
                                    </label>
                                </div>
                            </div>
                        `;
                    }
                }
                html += `
                            </div>
                        </div>
                    </div>
                `;

                document.getElementById('detalleContenido').innerHTML = html;
                $('#modalDetalle').modal('show');
            } else {
                Swal.fire({
                    icon: 'error',
                    title: 'Error',
                    text: data.message
                });
            }
        })
        .catch(error => {
            console.error('Error:', error);
            Swal.fire({
                icon: 'error',
                title: 'Error',
                text: 'Ha ocurrido un error al cargar los detalles'
            });
        });
}
</script>
{% endblock %} 