{% extends "base.html" %}

{% block title %}Cumpleaños{% endblock %}

{% block content %}
<div class="container-fluid py-4">
    <div class="row mb-4">
        <div class="col-12">
            <div class="card">
                <div class="card-header d-flex justify-content-between align-items-center">
                    <h5 class="mb-0">Cumpleaños por Mes</h5>
                    <div class="d-flex align-items-center">
                        <select class="form-select" id="selector-mes" style="width:auto;">
                            <option value="1">Enero</option>
                            <option value="2">Febrero</option>
                            <option value="3">Marzo</option>
                            <option value="4">Abril</option>
                            <option value="5">Mayo</option>
                            <option value="6">Junio</option>
                            <option value="7">Julio</option>
                            <option value="8">Agosto</option>
                            <option value="9">Septiembre</option>
                            <option value="10">Octubre</option>
                            <option value="11">Noviembre</option>
                            <option value="12">Diciembre</option>
                        </select>
                    </div>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-striped table-hover">
                            <thead class="table-dark">
                                <tr>
                                    <th>Nombre</th>
                                    <th>Fecha</th>
                                </tr>
                            </thead>
                            <tbody id="tabla-cumpleanos"></tbody>
                        </table>
                    </div>
                    <div id="estado" class="text-muted"></div>
                </div>
            </div>
        </div>
    </div>
</div>
{% endblock %}

{% block scripts %}
<script>
function cargarCumpleanos() {
    const mes = parseInt(document.getElementById('selector-mes').value);
    const estado = document.getElementById('estado');
    estado.textContent = 'Cargando...';
    fetch(`/api/admin/cumpleanos?mes=${mes}`)
        .then(r => r.json())
        .then(data => {
            const tbody = document.getElementById('tabla-cumpleanos');
            tbody.innerHTML = '';
            if (data && data.success && Array.isArray(data.cumpleanos) && data.cumpleanos.length > 0) {
                data.cumpleanos.forEach(item => {
                    const tr = document.createElement('tr');
                    const tdNombre = document.createElement('td');
                    tdNombre.textContent = item.nombre || '';
                    const tdFecha = document.createElement('td');
                    tdFecha.textContent = item.fecha_mostrar || (item.fecha || '');
                    tr.appendChild(tdNombre);
                    tr.appendChild(tdFecha);
                    tbody.appendChild(tr);
                });
                estado.textContent = `Total: ${data.cumpleanos.length}`;
            } else {
                estado.textContent = 'Sin registros para este mes';
            }
        })
        .catch(err => {
            document.getElementById('estado').textContent = `Error: ${err}`;
        });
}

document.addEventListener('DOMContentLoaded', function() {
    const hoy = new Date();
    document.getElementById('selector-mes').value = hoy.getMonth() + 1;
    cargarCumpleanos();
    document.getElementById('selector-mes').addEventListener('change', cargarCumpleanos);
});
</script>
{% endblock %}

